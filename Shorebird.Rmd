---
title: "ShoreBird_Shiny"
output: html_document
date: "2024-12-30"
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(shiny)
```

```{r}
# Define UI
ui <- fluidPage(
  titlePanel("Shorebird Data Entry"),
  
  sidebarLayout(
    sidebarPanel(
      dateInput("date", "Survey Date:", value = Sys.Date(), format = "mm/dd/yyyy"),
      
      selectInput("zone", "Zone Class:",
                  choices = c("Select Zone", "I", "II", "III")),
      
      selectInput("dataType", "Species:",
                  choices = c("Select Species", "Great Blue Heron", "Great Egret", "Snowy Egret", "People", "Dogs on Leash", "Brown Pelican", "Cormorant", "Black-Bellied Plover", "Willet", "Wandering Tattler", "Spotted Sandpiper", "Marbled Godwit", "Whimbrel", "Ruddy Turnstone", "Black Turnstone", "Surfbird", "Sanderling", "Juvenile Gull", "Western Gull", "California Gull", "Heerman's Gull", "Herring Gull", "Tern", "Unidentified Gull", "Unidentified Bird (non-gull)", "Black Phoebe", "Say's Phoebe")),
      
      numericInput("dataCount", "Data Count:", value = 1, min = 1),
      
      actionButton("submit", "Submit"),
      actionButton("removeLast", "Remove Last Entry"),
      downloadButton("downloadData", "Download CSV")
    ),
    
    mainPanel(
      textOutput("status"),
      tableOutput("dataTable")  # Display the submitted data
    )
  )
)

# Define server logic
server <- function(input, output, session) {
  
  # Reactive value to store data
  data <- reactiveVal(data.frame(SurveyDate = character(),
                                  ZoneClass = factor(levels = c("I", "II", "III")),
                                  DataType = character(),
                                  DataCount = numeric(),
                                  stringsAsFactors = FALSE))
  
  observeEvent(input$submit, {
    # Create a new row of data with formatted date
    new_data <- data.frame(SurveyDate = format(input$date, "%m/%d/%Y"),  # Format date as MM/DD/YYYY
                            ZoneClass = factor(input$zone, levels = c("I", "II", "III")),
                            DataType = input$dataType,
                            DataCount = input$dataCount,
                            stringsAsFactors = FALSE)
    
    # Append new data to existing data
    updated_data <- rbind(data(), new_data)
    data(updated_data)
    
    # Update status message
    output$status <- renderText("Data submitted successfully!")
    
    # Reset inputs
    updateSelectInput(session, "dataType", selected = "Select Species")
    updateNumericInput(session, "dataCount", value = 1)
    updateSelectInput(session, "zone", selected = "Select Zone")
  })
  
  # Remove the last entry
  observeEvent(input$removeLast, {
    current_data <- data()
    if (nrow(current_data) > 0) {
      # Remove the last row
      updated_data <- current_data[-nrow(current_data), ]
      data(updated_data)
      output$status <- renderText("Last entry removed successfully!")
    } else {
      output$status <- renderText("No entries to remove.")
    }
  })
  
  # Display the submitted data in a table
  output$dataTable <- renderTable({
    data()
  }, rownames = TRUE)  # Include row names
  
  # Download handler for CSV
  output$downloadData <- downloadHandler(
    filename = function() {
      paste("shorebird_data_", Sys.Date(), ".csv", sep = "")
    },
    content = function(file) {
      write.csv(data(), file, row.names = FALSE)
    }
  )
}

# Run the application 
shinyApp(ui = ui, server = server)
```

